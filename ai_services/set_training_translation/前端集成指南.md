# ğŸ¨ å‰ç«¯é›†æˆæŒ‡å— - æ‰‹è¯­è¯†åˆ« API

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®Œæ•´æµç¨‹å›¾](#å®Œæ•´æµç¨‹å›¾)
- [æ­¥éª¤è¯¦è§£](#æ­¥éª¤è¯¦è§£)
- [å®Œæ•´ä»£ç ç¤ºä¾‹](#å®Œæ•´ä»£ç ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

1. âœ… åç«¯ API æœåŠ¡å·²å¯åŠ¨ (`http://localhost:5000`)
2. âœ… æµè§ˆå™¨æ”¯æŒ `getUserMedia` (è·å–æ‘„åƒå¤´)
3. âœ… æµè§ˆå™¨æ”¯æŒ `fetch` API (å‘é€ HTTP è¯·æ±‚)

### æœ€ç®€ç¤ºä¾‹ (30 ç§’ä¸Šæ‰‹)

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>æ‰‹è¯­è¯†åˆ«ç¤ºä¾‹</title>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay></video>
    <button onclick="recognize()">è¯†åˆ«æ‰‹è¯­</button>
    <p>ç»“æœ: <span id="result">-</span></p>

    <script>
      // 1. å¯åŠ¨æ‘„åƒå¤´
      navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
        document.getElementById("video").srcObject = stream;
      });

      // 2. è¯†åˆ«æ‰‹è¯­
      async function recognize() {
        const video = document.getElementById("video");

        // æ•è·å½“å‰å¸§
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        // è½¬æ¢ä¸º base64
        const imageData = canvas.toDataURL("image/jpeg", 0.8);

        // å‘é€åˆ°åç«¯
        const response = await fetch("http://localhost:5000/api/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: imageData }),
        });

        // æ˜¾ç¤ºç»“æœ
        const result = await response.json();
        if (result.success && result.detected) {
          document.getElementById("result").textContent = `${result.word} (${(
            result.confidence * 100
          ).toFixed(1)}%)`;
        }
      }
    </script>
  </body>
</html>
```

---

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬ä¸€æ­¥: è·å–æ‘„åƒå¤´è§†é¢‘æµ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    navigator.mediaDevices.getUserMedia({ video: true })
                              â†“
    video.srcObject = stream  â† æ˜¾ç¤ºè§†é¢‘æµ
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬äºŒæ­¥: æ•è·è§†é¢‘å¸§                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
                              â†“
    ctx.drawImage(video, 0, 0);  â† å°†å½“å‰å¸§ç»˜åˆ¶åˆ° Canvas
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬ä¸‰æ­¥: è½¬æ¢ä¸º base64                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    const imageData = canvas.toDataURL('image/jpeg', 0.8);
                              â†“
    è¿”å›: "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬å››æ­¥: å‘é€åˆ°åç«¯ API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    fetch('http://localhost:5000/api/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            image: imageData,
            draw_landmarks: true,  // å¯é€‰: æ˜¯å¦ç»˜åˆ¶æ‰‹éƒ¨å…³é”®ç‚¹
            return_all_probs: false // å¯é€‰: æ˜¯å¦è¿”å›æ‰€æœ‰ç±»åˆ«æ¦‚ç‡
        })
    })
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬äº”æ­¥: æ¥æ”¶è¯†åˆ«ç»“æœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    const result = await response.json();
                              â†“
    {
        "success": true,
        "detected": true,
        "word": "hello",
        "confidence": 0.92,
        "annotated_image": "data:image/jpeg;base64,..."  // å¯é€‰
    }
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬å…­æ­¥: æ˜¾ç¤ºç»“æœ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    æ˜¾ç¤ºè¯†åˆ«çš„å•è¯å’Œç½®ä¿¡åº¦
```

---

## ğŸ“ æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1: è·å–æ‘„åƒå¤´è§†é¢‘æµ

#### ä»£ç ç¤ºä¾‹

```javascript
// æ–¹å¼ 1: ä½¿ç”¨ async/await
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        width: { ideal: 640 }, // ç†æƒ³å®½åº¦
        height: { ideal: 480 }, // ç†æƒ³é«˜åº¦
      },
    });

    const video = document.getElementById("video");
    video.srcObject = stream;

    console.log("æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ");
  } catch (error) {
    console.error("æ— æ³•è®¿é—®æ‘„åƒå¤´:", error);
    alert("è¯·å…è®¸è®¿é—®æ‘„åƒå¤´");
  }
}

// æ–¹å¼ 2: ä½¿ç”¨ Promise
navigator.mediaDevices
  .getUserMedia({ video: true })
  .then((stream) => {
    document.getElementById("video").srcObject = stream;
  })
  .catch((error) => {
    console.error("æ‘„åƒå¤´é”™è¯¯:", error);
  });
```

#### æµè§ˆå™¨å…¼å®¹æ€§

```javascript
// æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  // æ”¯æŒ
  startCamera();
} else {
  alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®");
}
```

#### HTML å…ƒç´ 

```html
<video id="video" width="640" height="480" autoplay playsinline></video>
```

**æ³¨æ„:**

- `autoplay` - è‡ªåŠ¨æ’­æ”¾è§†é¢‘æµ
- `playsinline` - iOS Safari éœ€è¦æ­¤å±æ€§

---

### æ­¥éª¤ 2: æ•è·è§†é¢‘å¸§

#### æ ¸å¿ƒä»£ç 

```javascript
function captureFrame(video) {
  // åˆ›å»º Canvas å…ƒç´ 
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth; // ä½¿ç”¨è§†é¢‘å®é™…å®½åº¦
  canvas.height = video.videoHeight; // ä½¿ç”¨è§†é¢‘å®é™…é«˜åº¦

  // è·å–ç»˜å›¾ä¸Šä¸‹æ–‡
  const ctx = canvas.getContext("2d");

  // å°†è§†é¢‘å½“å‰å¸§ç»˜åˆ¶åˆ° Canvas
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  return canvas;
}
```

#### å®Œæ•´ç¤ºä¾‹

```javascript
function captureFrame(video) {
  // æ£€æŸ¥è§†é¢‘æ˜¯å¦å‡†å¤‡å°±ç»ª
  if (video.readyState !== video.HAVE_ENOUGH_DATA) {
    console.warn("è§†é¢‘å°šæœªå‡†å¤‡å°±ç»ª");
    return null;
  }

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  return canvas;
}
```

---

### æ­¥éª¤ 3: è½¬æ¢ä¸º base64

#### åŸºæœ¬è½¬æ¢

```javascript
const canvas = captureFrame(video);
const base64Image = canvas.toDataURL("image/jpeg", 0.8);

// ç»“æœç¤ºä¾‹:
// "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD..."
```

#### å‚æ•°è¯´æ˜

```javascript
canvas.toDataURL(type, quality);
```

| å‚æ•°      | è¯´æ˜            | ç¤ºä¾‹                                   |
| --------- | --------------- | -------------------------------------- |
| `type`    | å›¾ç‰‡æ ¼å¼        | `'image/jpeg'` (æ¨è) æˆ– `'image/png'` |
| `quality` | JPEG è´¨é‡ (0-1) | `0.8` (80% è´¨é‡ï¼Œæ¨è)                 |

#### è´¨é‡å¯¹æ¯”

```javascript
// é«˜è´¨é‡ (æ–‡ä»¶è¾ƒå¤§)
const highQuality = canvas.toDataURL("image/jpeg", 1.0); // 100%

// ä¸­ç­‰è´¨é‡ (æ¨è)
const mediumQuality = canvas.toDataURL("image/jpeg", 0.8); // 80%

// ä½è´¨é‡ (æ–‡ä»¶è¾ƒå°ï¼Œå¯èƒ½å½±å“è¯†åˆ«)
const lowQuality = canvas.toDataURL("image/jpeg", 0.5); // 50%
```

**æ¨è**: ä½¿ç”¨ `0.8` ä½œä¸ºè´¨é‡å‚æ•°ï¼Œå¹³è¡¡æ–‡ä»¶å¤§å°å’Œè¯†åˆ«å‡†ç¡®åº¦ã€‚

---

### æ­¥éª¤ 4: å‘é€åˆ°åç«¯ API

#### åŸºæœ¬è¯·æ±‚

```javascript
async function sendToAPI(imageData) {
  const response = await fetch("http://localhost:5000/api/predict", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      image: imageData,
    }),
  });

  return await response.json();
}
```

#### å®Œæ•´è¯·æ±‚ (å¸¦æ‰€æœ‰å‚æ•°)

```javascript
async function recognizeSign(imageData, options = {}) {
  const {
    apiUrl = "http://localhost:5000",
    drawLandmarks = false,
    returnAllProbs = false,
  } = options;

  try {
    const response = await fetch(`${apiUrl}/api/predict`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        image: imageData,
        draw_landmarks: drawLandmarks,
        return_all_probs: returnAllProbs,
      }),
    });

    // æ£€æŸ¥ HTTP çŠ¶æ€
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error("API è¯·æ±‚å¤±è´¥:", error);
    throw error;
  }
}
```

#### è¯·æ±‚å‚æ•°è¯´æ˜

| å‚æ•°               | ç±»å‹    | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜                           |
| ------------------ | ------- | ---- | ------ | ------------------------------ |
| `image`            | string  | âœ…   | -      | base64 ç¼–ç çš„å›¾ç‰‡              |
| `draw_landmarks`   | boolean | âŒ   | false  | æ˜¯å¦åœ¨è¿”å›å›¾ç‰‡ä¸Šç»˜åˆ¶æ‰‹éƒ¨å…³é”®ç‚¹ |
| `return_all_probs` | boolean | âŒ   | false  | æ˜¯å¦è¿”å›æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡         |

#### ä½¿ç”¨ç¤ºä¾‹

```javascript
// ç¤ºä¾‹ 1: åŸºæœ¬è°ƒç”¨
const result = await recognizeSign(imageData);

// ç¤ºä¾‹ 2: ç»˜åˆ¶å…³é”®ç‚¹
const result = await recognizeSign(imageData, {
  drawLandmarks: true,
});

// ç¤ºä¾‹ 3: è·å–æ‰€æœ‰æ¦‚ç‡
const result = await recognizeSign(imageData, {
  returnAllProbs: true,
});

// ç¤ºä¾‹ 4: è‡ªå®šä¹‰ API åœ°å€
const result = await recognizeSign(imageData, {
  apiUrl: "https://your-domain.com",
  drawLandmarks: true,
  returnAllProbs: true,
});
```

---

### æ­¥éª¤ 5: æ¥æ”¶è¯†åˆ«ç»“æœ

#### å“åº”æ ¼å¼

**æˆåŠŸæ£€æµ‹åˆ°æ‰‹åŠ¿:**

```json
{
  "success": true,
  "detected": true,
  "word": "hello",
  "confidence": 0.92,
  "annotated_image": "data:image/jpeg;base64,..." // ä»…å½“ draw_landmarks=true
}
```

**æœªæ£€æµ‹åˆ°æ‰‹åŠ¿:**

```json
{
  "success": true,
  "detected": false,
  "message": "æœªæ£€æµ‹åˆ°æ‰‹éƒ¨"
}
```

**åŒ…å«æ‰€æœ‰æ¦‚ç‡ (return_all_probs=true):**

```json
{
  "success": true,
  "detected": true,
  "word": "hello",
  "confidence": 0.92,
  "all_predictions": {
    "hello": 0.92,
    "thank": 0.08
  }
}
```

**é”™è¯¯å“åº”:**

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°"
}
```

#### å¤„ç†å“åº”

```javascript
async function handleRecognition(imageData) {
  try {
    const result = await recognizeSign(imageData);

    if (result.success && result.detected) {
      // âœ… è¯†åˆ«æˆåŠŸ
      console.log(`è¯†åˆ«ç»“æœ: ${result.word}`);
      console.log(`ç½®ä¿¡åº¦: ${(result.confidence * 100).toFixed(1)}%`);

      // æ˜¾ç¤ºç»“æœ
      document.getElementById("word").textContent = result.word;
      document.getElementById("confidence").textContent =
        (result.confidence * 100).toFixed(1) + "%";

      // å¦‚æœæœ‰æ ‡æ³¨å›¾ç‰‡
      if (result.annotated_image) {
        document.getElementById("resultImage").src = result.annotated_image;
      }
    } else if (result.success && !result.detected) {
      // âš ï¸ æœªæ£€æµ‹åˆ°æ‰‹åŠ¿
      console.log("æœªæ£€æµ‹åˆ°æ‰‹éƒ¨");
      document.getElementById("word").textContent = "æœªæ£€æµ‹åˆ°";
    } else {
      // âŒ è¯·æ±‚å¤±è´¥
      console.error("è¯†åˆ«å¤±è´¥:", result.message);
      alert(`é”™è¯¯: ${result.message}`);
    }
  } catch (error) {
    // âŒ ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
    console.error("è¯·æ±‚å¼‚å¸¸:", error);
    alert("æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨");
  }
}
```

---

### æ­¥éª¤ 6: æ˜¾ç¤ºç»“æœ

#### HTML ç»“æ„

```html
<div class="result-container">
  <div class="result-item">
    <label>è¯†åˆ«å•è¯:</label>
    <span id="word" class="result-value">-</span>
  </div>

  <div class="result-item">
    <label>ç½®ä¿¡åº¦:</label>
    <span id="confidence" class="result-value">-</span>
  </div>

  <div class="result-item">
    <label>æ ‡æ³¨å›¾ç‰‡:</label>
    <img id="resultImage" src="" alt="è¯†åˆ«ç»“æœ" />
  </div>
</div>
```

#### JavaScript æ›´æ–°

```javascript
function displayResult(result) {
  // æ›´æ–°å•è¯
  const wordElement = document.getElementById("word");
  wordElement.textContent = result.word;

  // æ›´æ–°ç½®ä¿¡åº¦
  const confidenceElement = document.getElementById("confidence");
  const confidencePercent = (result.confidence * 100).toFixed(1);
  confidenceElement.textContent = confidencePercent + "%";

  // æ ¹æ®ç½®ä¿¡åº¦è®¾ç½®é¢œè‰²
  if (result.confidence > 0.8) {
    confidenceElement.style.color = "green"; // é«˜ç½®ä¿¡åº¦
  } else if (result.confidence > 0.5) {
    confidenceElement.style.color = "orange"; // ä¸­ç­‰ç½®ä¿¡åº¦
  } else {
    confidenceElement.style.color = "red"; // ä½ç½®ä¿¡åº¦
  }

  // æ˜¾ç¤ºæ ‡æ³¨å›¾ç‰‡
  if (result.annotated_image) {
    const imgElement = document.getElementById("resultImage");
    imgElement.src = result.annotated_image;
    imgElement.style.display = "block";
  }
}
```

---

## ğŸ’» å®Œæ•´ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: å•æ¬¡è¯†åˆ«

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‰‹è¯­è¯†åˆ« - å•æ¬¡è¯†åˆ«</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }

      video {
        width: 100%;
        max-width: 640px;
        border: 2px solid #333;
        border-radius: 8px;
      }

      button {
        padding: 12px 24px;
        font-size: 16px;
        margin: 10px 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .result {
        margin-top: 20px;
        padding: 15px;
        background: #f0f0f0;
        border-radius: 5px;
      }

      .result-value {
        font-size: 24px;
        font-weight: bold;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ¤Ÿ æ‰‹è¯­è¯†åˆ«ç¤ºä¾‹</h1>

    <!-- è§†é¢‘æ˜¾ç¤º -->
    <video id="video" autoplay playsinline></video>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <div>
      <button class="btn-primary" onclick="startCamera()">å¯åŠ¨æ‘„åƒå¤´</button>
      <button
        class="btn-success"
        onclick="recognizeOnce()"
        id="recognizeBtn"
        disabled
      >
        è¯†åˆ«æ‰‹è¯­
      </button>
    </div>

    <!-- ç»“æœæ˜¾ç¤º -->
    <div class="result">
      <p>è¯†åˆ«ç»“æœ: <span class="result-value" id="word">-</span></p>
      <p>ç½®ä¿¡åº¦: <span class="result-value" id="confidence">-</span></p>
    </div>

    <script>
      const video = document.getElementById("video");
      const API_URL = "http://localhost:5000/api/predict";

      // å¯åŠ¨æ‘„åƒå¤´
      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: 640, height: 480 },
          });
          video.srcObject = stream;
          document.getElementById("recognizeBtn").disabled = false;
          console.log("æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ");
        } catch (error) {
          console.error("æ‘„åƒå¤´é”™è¯¯:", error);
          alert("æ— æ³•è®¿é—®æ‘„åƒå¤´: " + error.message);
        }
      }

      // æ•è·å½“å‰å¸§
      function captureFrame() {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0);
        return canvas.toDataURL("image/jpeg", 0.8);
      }

      // è¯†åˆ«æ‰‹è¯­
      async function recognizeOnce() {
        try {
          // æ•è·å¸§
          const imageData = captureFrame();

          // å‘é€åˆ° API
          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: imageData }),
          });

          const result = await response.json();

          // æ˜¾ç¤ºç»“æœ
          if (result.success && result.detected) {
            document.getElementById("word").textContent = result.word;
            document.getElementById("confidence").textContent =
              (result.confidence * 100).toFixed(1) + "%";
          } else {
            document.getElementById("word").textContent = "æœªæ£€æµ‹åˆ°";
            document.getElementById("confidence").textContent = "-";
          }
        } catch (error) {
          console.error("è¯†åˆ«å¤±è´¥:", error);
          alert("API è°ƒç”¨å¤±è´¥: " + error.message);
        }
      }
    </script>
  </body>
</html>
```

---

### ç¤ºä¾‹ 2: å®æ—¶è¯†åˆ« (æŒç»­è¯†åˆ«)

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>æ‰‹è¯­è¯†åˆ« - å®æ—¶è¯†åˆ«</title>
    <style>
      /* æ ·å¼åŒä¸Š */
    </style>
  </head>
  <body>
    <h1>ğŸ¤Ÿ æ‰‹è¯­å®æ—¶è¯†åˆ«</h1>

    <video id="video" autoplay playsinline></video>

    <div>
      <button class="btn-primary" onclick="startCamera()">å¯åŠ¨æ‘„åƒå¤´</button>
      <button
        class="btn-success"
        onclick="startRecognition()"
        id="startBtn"
        disabled
      >
        å¼€å§‹è¯†åˆ«
      </button>
      <button
        class="btn-danger"
        onclick="stopRecognition()"
        id="stopBtn"
        disabled
      >
        åœæ­¢è¯†åˆ«
      </button>
    </div>

    <div class="result">
      <p>è¯†åˆ«ç»“æœ: <span class="result-value" id="word">-</span></p>
      <p>ç½®ä¿¡åº¦: <span class="result-value" id="confidence">-</span></p>
      <p>è¯†åˆ«æ¬¡æ•°: <span id="count">0</span></p>
    </div>

    <script>
      const video = document.getElementById("video");
      const API_URL = "http://localhost:5000/api/predict";
      let recognitionInterval = null;
      let detectionCount = 0;

      // å¯åŠ¨æ‘„åƒå¤´
      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          video.srcObject = stream;
          document.getElementById("startBtn").disabled = false;
        } catch (error) {
          alert("æ— æ³•è®¿é—®æ‘„åƒå¤´: " + error.message);
        }
      }

      // æ•è·å¸§
      function captureFrame() {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        return canvas.toDataURL("image/jpeg", 0.8);
      }

      // è¯†åˆ«å‡½æ•°
      async function recognize() {
        try {
          const imageData = captureFrame();

          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: imageData }),
          });

          const result = await response.json();

          if (result.success && result.detected) {
            document.getElementById("word").textContent = result.word;
            document.getElementById("confidence").textContent =
              (result.confidence * 100).toFixed(1) + "%";
            detectionCount++;
            document.getElementById("count").textContent = detectionCount;
          } else {
            document.getElementById("word").textContent = "æœªæ£€æµ‹åˆ°";
          }
        } catch (error) {
          console.error("è¯†åˆ«å¤±è´¥:", error);
        }
      }

      // å¼€å§‹æŒç»­è¯†åˆ«
      function startRecognition() {
        if (recognitionInterval) return;

        document.getElementById("startBtn").disabled = true;
        document.getElementById("stopBtn").disabled = false;

        // æ¯ 200ms è¯†åˆ«ä¸€æ¬¡ (5 FPS)
        recognitionInterval = setInterval(recognize, 200);
      }

      // åœæ­¢è¯†åˆ«
      function stopRecognition() {
        if (recognitionInterval) {
          clearInterval(recognitionInterval);
          recognitionInterval = null;
        }

        document.getElementById("startBtn").disabled = false;
        document.getElementById("stopBtn").disabled = true;
      }
    </script>
  </body>
</html>
```

---

### ç¤ºä¾‹ 3: React ç»„ä»¶

```jsx
import React, { useRef, useState, useEffect } from "react";

const SignLanguageRecognizer = () => {
  const videoRef = useRef(null);
  const [result, setResult] = useState({ word: "-", confidence: 0 });
  const [isRecognizing, setIsRecognizing] = useState(false);
  const [cameraStarted, setCameraStarted] = useState(false);

  const API_URL = "http://localhost:5000/api/predict";

  // å¯åŠ¨æ‘„åƒå¤´
  const startCamera = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: true,
      });
      if (videoRef.current) {
        videoRef.current.srcObject = stream;
        setCameraStarted(true);
      }
    } catch (error) {
      console.error("æ‘„åƒå¤´é”™è¯¯:", error);
      alert("æ— æ³•è®¿é—®æ‘„åƒå¤´");
    }
  };

  // æ•è·å¸§
  const captureFrame = () => {
    const video = videoRef.current;
    if (!video) return null;

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    return canvas.toDataURL("image/jpeg", 0.8);
  };

  // è¯†åˆ«å‡½æ•°
  const recognize = async () => {
    const imageData = captureFrame();
    if (!imageData) return;

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: imageData }),
      });

      const data = await response.json();

      if (data.success && data.detected) {
        setResult({
          word: data.word,
          confidence: (data.confidence * 100).toFixed(1),
        });
      } else {
        setResult({ word: "æœªæ£€æµ‹åˆ°", confidence: 0 });
      }
    } catch (error) {
      console.error("è¯†åˆ«å¤±è´¥:", error);
    }
  };

  // æŒç»­è¯†åˆ«
  useEffect(() => {
    if (!isRecognizing) return;

    const interval = setInterval(recognize, 200);
    return () => clearInterval(interval);
  }, [isRecognizing]);

  return (
    <div style={{ padding: "20px" }}>
      <h1>æ‰‹è¯­è¯†åˆ«</h1>

      <video
        ref={videoRef}
        width="640"
        height="480"
        autoPlay
        playsInline
        style={{ border: "2px solid #333", borderRadius: "8px" }}
      />

      <div style={{ marginTop: "20px" }}>
        {!cameraStarted && <button onClick={startCamera}>å¯åŠ¨æ‘„åƒå¤´</button>}

        {cameraStarted && (
          <>
            <button
              onClick={() => setIsRecognizing(true)}
              disabled={isRecognizing}
            >
              å¼€å§‹è¯†åˆ«
            </button>
            <button
              onClick={() => setIsRecognizing(false)}
              disabled={!isRecognizing}
            >
              åœæ­¢è¯†åˆ«
            </button>
          </>
        )}
      </div>

      <div
        style={{ marginTop: "20px", padding: "15px", background: "#f0f0f0" }}
      >
        <p>
          è¯†åˆ«ç»“æœ: <strong>{result.word}</strong>
        </p>
        <p>
          ç½®ä¿¡åº¦: <strong>{result.confidence}%</strong>
        </p>
      </div>
    </div>
  );
};

export default SignLanguageRecognizer;
```

---

### ç¤ºä¾‹ 4: Vue ç»„ä»¶

```vue
<template>
  <div class="sign-language-recognizer">
    <h1>æ‰‹è¯­è¯†åˆ«</h1>

    <video ref="videoRef" width="640" height="480" autoplay playsinline></video>

    <div class="controls">
      <button @click="startCamera" v-if="!cameraStarted">å¯åŠ¨æ‘„åƒå¤´</button>
      <button
        @click="startRecognition"
        :disabled="isRecognizing"
        v-if="cameraStarted"
      >
        å¼€å§‹è¯†åˆ«
      </button>
      <button
        @click="stopRecognition"
        :disabled="!isRecognizing"
        v-if="cameraStarted"
      >
        åœæ­¢è¯†åˆ«
      </button>
    </div>

    <div class="result">
      <p>
        è¯†åˆ«ç»“æœ: <strong>{{ result.word }}</strong>
      </p>
      <p>
        ç½®ä¿¡åº¦: <strong>{{ result.confidence }}%</strong>
      </p>
    </div>
  </div>
</template>

<script>
export default {
  name: "SignLanguageRecognizer",
  data() {
    return {
      cameraStarted: false,
      isRecognizing: false,
      recognitionInterval: null,
      result: {
        word: "-",
        confidence: 0,
      },
      API_URL: "http://localhost:5000/api/predict",
    };
  },
  methods: {
    async startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
        });
        this.$refs.videoRef.srcObject = stream;
        this.cameraStarted = true;
      } catch (error) {
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´: " + error.message);
      }
    },

    captureFrame() {
      const video = this.$refs.videoRef;
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      return canvas.toDataURL("image/jpeg", 0.8);
    },

    async recognize() {
      const imageData = this.captureFrame();

      try {
        const response = await fetch(this.API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: imageData }),
        });

        const data = await response.json();

        if (data.success && data.detected) {
          this.result = {
            word: data.word,
            confidence: (data.confidence * 100).toFixed(1),
          };
        } else {
          this.result = { word: "æœªæ£€æµ‹åˆ°", confidence: 0 };
        }
      } catch (error) {
        console.error("è¯†åˆ«å¤±è´¥:", error);
      }
    },

    startRecognition() {
      this.isRecognizing = true;
      this.recognitionInterval = setInterval(() => {
        this.recognize();
      }, 200);
    },

    stopRecognition() {
      this.isRecognizing = false;
      if (this.recognitionInterval) {
        clearInterval(this.recognitionInterval);
        this.recognitionInterval = null;
      }
    },
  },
  beforeUnmount() {
    this.stopRecognition();
  },
};
</script>

<style scoped>
.sign-language-recognizer {
  padding: 20px;
}

video {
  border: 2px solid #333;
  border-radius: 8px;
}

.controls {
  margin-top: 20px;
}

button {
  padding: 10px 20px;
  margin: 0 5px;
  font-size: 16px;
}

.result {
  margin-top: 20px;
  padding: 15px;
  background: #f0f0f0;
  border-radius: 5px;
}
</style>
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ‘„åƒå¤´æ— æ³•å¯åŠ¨ï¼Ÿ

**å¯èƒ½åŸå› :**

1. æµè§ˆå™¨ä¸æ”¯æŒ `getUserMedia`
2. ç”¨æˆ·æ‹’ç»äº†æ‘„åƒå¤´æƒé™
3. æ‘„åƒå¤´è¢«å…¶ä»–åº”ç”¨å ç”¨
4. ä½¿ç”¨ HTTP è€Œé HTTPS (æŸäº›æµè§ˆå™¨é™åˆ¶)

**è§£å†³æ–¹æ¡ˆ:**

```javascript
// æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
  alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®ï¼Œè¯·ä½¿ç”¨ Chrome/Firefox/Edge ç­‰ç°ä»£æµè§ˆå™¨");
}

// æ•è·é”™è¯¯
try {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  // ...
} catch (error) {
  if (error.name === "NotAllowedError") {
    alert("è¯·å…è®¸è®¿é—®æ‘„åƒå¤´");
  } else if (error.name === "NotFoundError") {
    alert("æœªæ£€æµ‹åˆ°æ‘„åƒå¤´è®¾å¤‡");
  } else {
    alert("æ‘„åƒå¤´é”™è¯¯: " + error.message);
  }
}
```

---

### Q2: ä¸ºä»€ä¹ˆ API è¯·æ±‚å¤±è´¥ï¼Ÿ

**å¯èƒ½åŸå› :**

1. åç«¯æœåŠ¡æœªå¯åŠ¨
2. API åœ°å€é”™è¯¯
3. è·¨åŸŸé—®é¢˜ (CORS)

**è§£å†³æ–¹æ¡ˆ:**

```javascript
// æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
async function checkAPI() {
  try {
    const response = await fetch("http://localhost:5000/api/health");
    const data = await response.json();
    console.log("API çŠ¶æ€:", data);
  } catch (error) {
    alert("æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·ç¡®ä¿æœåŠ¡å·²å¯åŠ¨");
  }
}

// æ•è·ç½‘ç»œé”™è¯¯
try {
  const response = await fetch(API_URL, {
    /* ... */
  });
  if (!response.ok) {
    throw new Error(`HTTP ${response.status}`);
  }
  // ...
} catch (error) {
  console.error("è¯·æ±‚å¤±è´¥:", error);
  alert("API è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥:\n1. åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n2. API åœ°å€æ˜¯å¦æ­£ç¡®");
}
```

---

### Q3: å¦‚ä½•æé«˜è¯†åˆ«é€Ÿåº¦ï¼Ÿ

**ä¼˜åŒ–å»ºè®®:**

1. **é™ä½å›¾ç‰‡è´¨é‡**

   ```javascript
   canvas.toDataURL("image/jpeg", 0.6); // é™ä½åˆ° 60%
   ```

2. **å‡å°‘å›¾ç‰‡å°ºå¯¸**

   ```javascript
   const canvas = document.createElement("canvas");
   canvas.width = 320; // ç¼©å°å°ºå¯¸
   canvas.height = 240;
   ctx.drawImage(video, 0, 0, 320, 240);
   ```

3. **å¢åŠ è¯†åˆ«é—´éš”**

   ```javascript
   setInterval(recognize, 500); // æ”¹ä¸º 500ms (2 FPS)
   ```

4. **ä¸ç»˜åˆ¶å…³é”®ç‚¹**
   ```javascript
   body: JSON.stringify({
     image: imageData,
     draw_landmarks: false, // å…³é—­å…³é”®ç‚¹ç»˜åˆ¶
   });
   ```

---

### Q4: å¦‚ä½•å¤„ç†è¯†åˆ«ç»“æœçš„æŠ–åŠ¨ï¼Ÿ

**é—®é¢˜**: è¯†åˆ«ç»“æœé¢‘ç¹å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ é˜²æŠ–é€»è¾‘

```javascript
let lastWord = "";
let lastWordTime = 0;
let wordStableCount = 0;

function handleResult(result) {
  if (result.success && result.detected) {
    const now = Date.now();

    // å¦‚æœæ˜¯ç›¸åŒçš„è¯ï¼Œå¢åŠ è®¡æ•°
    if (result.word === lastWord) {
      wordStableCount++;
    } else {
      lastWord = result.word;
      wordStableCount = 1;
    }

    // åªæœ‰è¿ç»­è¯†åˆ«åˆ° 3 æ¬¡ä»¥ä¸Šæ‰æ˜¾ç¤º
    if (wordStableCount >= 3 || now - lastWordTime > 2000) {
      document.getElementById("word").textContent = result.word;
      lastWordTime = now;
    }
  }
}
```

---

### Q5: ç§»åŠ¨ç«¯å¦‚ä½•ä½¿ç”¨ï¼Ÿ

**æ³¨æ„äº‹é¡¹:**

1. ä½¿ç”¨ `playsinline` å±æ€§
2. è€ƒè™‘å±å¹•æ–¹å‘
3. ä¼˜åŒ–è§¦æ‘¸äº¤äº’

```html
<video autoplay playsinline webkit-playsinline></video>

<style>
  @media (max-width: 768px) {
    video {
      width: 100%;
      height: auto;
    }
  }
</style>

<script>
  // è¯·æ±‚åç½®æ‘„åƒå¤´
  const stream = await navigator.mediaDevices.getUserMedia({
      video: {
          facingMode: 'environment'  // 'user' ä¸ºå‰ç½®æ‘„åƒå¤´
      }
  });
</script>
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [API ä½¿ç”¨æ–‡æ¡£](APIä½¿ç”¨æ–‡æ¡£.md) - å®Œæ•´çš„ API å‚è€ƒ
- [æœåŠ¡å™¨å¯¹æ¯”è¯´æ˜](æœåŠ¡å™¨å¯¹æ¯”è¯´æ˜.md) - ä¸¤ä¸ªæœåŠ¡å™¨çš„åŒºåˆ«
- [MDN - getUserMedia](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia)
- [MDN - Canvas API](https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API)
- [MDN - Fetch API](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API)

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ­¥éª¤ (è®°ä½è¿™ 5 è¡Œä»£ç )

```javascript
// 1. å¯åŠ¨æ‘„åƒå¤´
const stream = await navigator.mediaDevices.getUserMedia({ video: true });

// 2. æ•è·å¸§å¹¶è½¬ base64
const canvas = document.createElement("canvas");
canvas.getContext("2d").drawImage(video, 0, 0);
const imageData = canvas.toDataURL("image/jpeg", 0.8);

// 3. å‘é€åˆ° API
const response = await fetch("http://localhost:5000/api/predict", {
  method: "POST",
  body: JSON.stringify({ image: imageData }),
});

// 4. è·å–ç»“æœ
const result = await response.json();

// 5. æ˜¾ç¤ºç»“æœ
if (result.detected) {
  console.log(result.word, result.confidence);
}
```

---

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå®Œæ•´çš„ [API ä½¿ç”¨æ–‡æ¡£](APIä½¿ç”¨æ–‡æ¡£.md)ã€‚
